{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "mapping.json",
  "title": "ReqIF Choice Schema",
  "description": "JSON Schema where each field can match against any ReqIF attribute type using external definitions",
  "type": "object",
  "required": [
    "specification",
    "requirements",
    "config"
  ],
  "properties": {
    "config": {
      "$ref": "./defs/types/defaults.json#/definitions/config"
    },
    "specification": {
      "type": "object",
      "required": [
        "attributes",
        "selector",
        "requirements",
        "caption",
        "id",
        "type"
      ],
      "additionalProperties": false,
      "properties": {
        "attributes": {
          "$ref": "./defs/specification.json#/definitions/specification"
        },
        "caption": {
          "allOf": [
            {
              "description": "JSONPath selector of Specification Caption, all matching nodes are joined in a single string"
            },
            {
              "$ref": "./defs/types/defaults.json#/definitions/selector"
            }
          ]
        },
        "id": {
          "allOf": [
            {
              "description": "JSONPath selector of Specification Id to build unique yet stable identifier within ReqIF"
            },
            {
              "$ref": "./defs/types/defaults.json#/definitions/selector"
            }
          ]
        },
        "selector": {
          "$ref": "./defs/types/defaults.json#/definitions/selector"
        },
        "requirements": {
          "$ref": "./defs/types/defaults.json#/definitions/selector"
        },
        "type": {
          "type": "string"
        }        
      }
    },
    "requirements": {
      "type": "object",
      "required": [
        "children",
        "selector",
        "variants"
      ],
      "additionalProperties": false,
      "properties": {
        "selector": {
          "$ref": "./defs/types/defaults.json#/definitions/selector"
        },
        "children": {
          "allOf": [
            {
              "description": "Requirements hierarchy JSONPath selector based on the current node, empty selector match creates leaf requirement"
            },
            {
              "$ref": "./defs/types/defaults.json#/definitions/selector"
            }
          ]
        },
        "variants": {
          "type": "array",
          "minItems": 1,
          "additionalItems": false,
          "items": {
            "type": "object",
            "required": [
              "attributes",
              "match"
            ],
            "additionalProperties": false,
            "properties": {
              "match": {
                "$ref": "./defs/types/defaults.json#/definitions/selector"
              },
              "attributes": {
                "$ref": "./defs/requirement.json#/definitions/requirement"
              },
              "selector": {
                "$ref": "./defs/types/defaults.json#/definitions/selector"
              },
              "children": {
                "allOf": [
                  {
                    "description": "Requirements hierarchy JSONPath selector based on the current node, empty selector match creates leaf requirement"
                  },
                  {
                    "$ref": "./defs/types/defaults.json#/definitions/selector"
                  }
                ]
              }
            }
          }
        }
      },
      "relations": {
        "$ref": "./defs/relation.json#/definitions/relation"
      }
    }
  }
}